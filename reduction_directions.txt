##################################################

Directions to Self on Using IRAF Reduction and Extraction Scripts
Optimized for observations in the 3x60’’ mode

##################################################

A: Load the necessary NOAO procedures
noao
imred
specred
ccdred

B: Prepare data
Put all data into a directory called "edited" - this will contain a duplicate of all raw data
All data files should be called "run*.fits" (it’s OK if they’re sky images called runsky*.fits)
All flat images (with relevant (3x60) slit) should be "flat*.fits"
All dark images should be dark*.fits
All arc images (with relevant (0.3 x 60) slit) should be arc*.fits
All sky files (if using) should be listed in sky_choices.txt
Get rid of all periods except for the ending of files may be file.a.fits or file.b.fits
Make a "proc" directory adjacent to the edited folder


C: Load all IRAF scripts
#(If necessary)
task $adjust_headers=/Users/everettschlawin/es_programs/reduction_scripts/adjust_headers.cl

#Run these in the edited directory, first set the trim section & other reduction parameters
task $reduction_script=/Users/everettschlawin/es_programs/reduction_scripts/reduction_script.cl

#The reset script allows you to reset in case of a mistake
task $reset_reduction=/Users/everettschlawin/es_programs/reduction_scripts/reset_reduction.cl

#Run these in the proc directory

task $extraction_script=/Users/everettschlawin/es_programs/reduction_scripts/extraction_script.cl
#The reset script allows you to reset in case of a mistake
#I might have to go into the database/idfirst_wavecal and confirm that the coefficients of the dispersion function are the exact same for aperture 1 and aperture 2
task $reset_extraction=/Users/everettschlawin/es_programs/reduction_scripts/reset_extraction.cl

task $cleanup_dup_files=/Users/everettschlawin/es_programs/reduction_scripts/cleanup_dup_files.cl

D: Reduce data from the “edited” directory
adjust_headers
# Correct for non-linearity
!echo “ev_compile_red & correct_linearity” | idl
cl < local_red_params.cl
#Including flat field, linearity correction, bad pixel mask, dark subtraction etc.
# Requires a file local_red_params.cl that defines b1=yes/no and s1 = "[65:749,33:607]" (or whatever trim region)
#Change to the edited directory and run
# If you have local red_params b1 = yes, it will use the sky flats. You’ll need to select a set of sky images to combine (called sky_choices.txt). You can also have optional mask_for_runsky005.fits files to specify where to mask out sources
reduction_script

E: Extract Spectra. Navigate the “proc” directory
#Choose a reference aperture (an image where the apertures are found correctly) For example:
ls run02_0034.a_lincor_straight.fits > ap_reference.txt
# Make a local parameter file for the background region, star separation and background order. #You can copy the master one
# Define the local parameters
cl < local_parameters.cl

# Copy a idfirst_wavecal from another previous extraction to make the line identification easier



#Straightens (rectifies) all spectral images
#Extracts the spectra with background subtraction
#Makes FITS files of the flux versus wavelength
extraction_script
# If the first time running, edit the identification file so that the coefficients for Aperture 1 and Aperture 2 are identical and run again
emacs database/idfirst_wavecal

F: If Needing to reset
reset_reduction
reset_extraction


************************
G: ERRORS
Error in image section specification - usually it happens when I haven’t loaded the local parameters in (either cl < local_red_parameters in the “edited” directory or cl < local_parameters in the “processed” directory)
